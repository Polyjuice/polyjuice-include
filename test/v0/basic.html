<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
    <title>starcounter-include basic test</title>
    <script src="../../../webcomponentsjs/webcomponents.js"></script>
    <script src="../../../document-register-element/build/document-register-element.js"></script>
    <script src="../../../web-component-tester/browser.js"></script>
    <script src="../helpers/pre-config.js"></script>
    <link rel="import" href="../../../polymer/polymer.html">

    <link rel="import" href="../../starcounter-include.html">
</head>

<body>
    <template id="composition">
        <h1>My shadow composition</h1>
        with shadowElement
        <content select='[slot="my-slot1"]'></content>
        <!-- <slot name="my-slot1"></slot> -->
        <content select='[slot="my-slot2"]'></content>
    </template>
    <test-fixture id="element">
        <template>
            <div>
                <template is="dom-bind">
                    <starcounter-include view-model="{{partial}}">
                        <div id="childNode1" slot="my-slot1">childNode1</div>
                        <div id="childNode2" slot="my-slot2">childNode2</div>
                    </starcounter-include>
                </template>
            </div>
        </template>
    </test-fixture>
</body>
<script>
    var scInclude, compositionTemplate, container, domBind, composition;
    describe('starcounter-include', function () {


        describe('when created', function () {
            beforeEach(function () {
                scInclude = document.createElement('starcounter-include');
            });
            it('should create shadowRoot', function () {
                expect(scInclude).to.have.property('shadowRoot').to.be.not.null;
                expect(scInclude).to.have.property('shadowRoot').instanceof(DocumentFragment);
            });
            it('should create shadowRoot with default slot', function () {
                expect(scInclude.shadowRoot.querySelector('content')).to.be.not.null;
                expect(scInclude.shadowRoot.querySelector('content')).to.be.instanceof(HTMLContentElement);
            });
        });

        describe('when `.composition` property is set, once `.stamp` method is called', function () {
            beforeEach(function (done) {
                container = fixture('element');
                domBind = container.querySelector('template[is="dom-bind"]');
                // domBind.addEventListener('dom-change', function waitForDomBind(){
                    scInclude = container.querySelector('starcounter-include');
                    composition = document.querySelector('#composition').innerHTML;
                    domBind.set('partial', {CompositionProvider:{Composition$: null}});
                    domBind.set('partial.CompositionProvider.Composition$', composition);
                    // setTimeout(function waitForPolyfilledUpgrade(){
                        done();
                    // },100);

                // });
            });
            it('should create shadowRoot with given Document Fragment', function () {
                expect(scInclude).to.have.property('shadowRoot');
                // expect(scInclude.shadowRoot).to.have.property('innerHTML', compositionTemplate.innerHTML);
                expect(scInclude.shadowRoot.innerHTML).to.equal(composition);
            });
            it('should distribute its children, which has `slot` attribute matching slot(content) tag within given shadow DOM', function () {
                expect(scInclude.children[1].getDestinationInsertionPoints().length).to.be.greaterThan(0);
            });
        });
    });
</script>

</html>
