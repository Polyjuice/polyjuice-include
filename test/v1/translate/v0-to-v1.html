<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

	<script src="../../../../webcomponentsjs/webcomponents-lite.js"></script>
	<script src="../../../../web-component-tester/browser.js"></script>
    <script src="../../helpers/composition-fixtures.js"></script>
    <script src="../../helpers/compareHTMLStrings.js"></script>

	<link rel="import" href="../../../starcounter-include.html">
</head>

<body>
	<test-fixture id="element">
		<template>
			<starcounter-include></starcounter-include>
		</template>
	</test-fixture>
	<template id="composition">
		<style>
			.foo,
			::content p,
			.bar{
				color: green;
			}
		</style>
		<h2>Custom Shadow DOM composition</h2>
		<content select="[slot='my-slot']"></content>
		<content></content>
		<content    select="[slot='my-slot']"    ></content>
		<content    ></content    >
		<content foo="bar" select="[slot='my-slot']" baz></content>
		<content name="old-name" select="[slot='my-slot']"></content>
		<content select="[name='my-slot']"></content>
		<content select=".other-selector"></content>
		<slot name="untouched"></slot>
	</template>

	<template id="reference-composition">
		<style>
			.foo,
			::slotted(p)/* FIXME V1 matches only direct children;*/,
			.bar{
				color: green;
			}
		</style>
		<h2>Custom Shadow DOM composition</h2>
		<slot select="[slot='my-slot']" name="my-slot"></slot>
		<slot></slot>
		<slot    select="[slot='my-slot']"     name="my-slot"></slot>
		<slot    ></slot    >
		<slot foo="bar" select="[slot='my-slot']" baz name="my-slot"></slot>
		<slot select="[slot='my-slot']" name="my-slot"></slot>
		<slot select="[name='my-slot']"></slot>
		<slot select=".other-selector"></slot>
		<slot name="untouched"></slot>
	</template>
	<template id="reference-composition-polyfilled">
		<style class="style-scope starcounter-include">
			.foo,
			::slotted(p)/* FIXME V1 matches only direct children;*/,
			.bar{
				color: green;
			}
		</style>
		<h2 class="style-scope starcounter-include">Custom Shadow DOM composition</h2>
		<slot select="[slot='my-slot']" name="my-slot" class="style-scope starcounter-include"></slot>
		<slot class="style-scope starcounter-include"></slot>
		<slot    select="[slot='my-slot']"     name="my-slot" class="style-scope starcounter-include"></slot>
		<slot     class="style-scope starcounter-include"></slot    >
		<slot foo="bar" select="[slot='my-slot']" baz name="my-slot" class="style-scope starcounter-include"></slot>
		<slot select="[slot='my-slot']" name="my-slot" class="style-scope starcounter-include"></slot>
		<slot select="[name='my-slot']" class="style-scope starcounter-include"></slot>
		<slot select=".other-selector" class="style-scope starcounter-include"></slot>
		<slot name="untouched" class="style-scope starcounter-include"></slot>
	</template>


	<script>
	describe('starcounter-include when stamps a composition which contains V0 `content` tags and `::content`', function () {
		const REFERENCE_COMPOSITION = document.querySelector(isShadyDOMinUse? '#reference-composition-polyfilled' : '#reference-composition').innerHTML

		var scInclude;
		afterEach(function (done) {
			// give more time to polyfill cleanup
			setTimeout(done);
		});
		beforeEach(function (done) {
			scInclude = fixture('element');
			scInclude.viewModel = {
				CompositionProvider_0:{
					Composition$: document.querySelector('#composition').innerHTML
				}
			};
			// scInclude.stamp();
			// setTimeout(done, 500);
			done();
		});
		it('should replace them with applicable `slot`s and `::slotted`', function () {
			expect(scInclude.shadowRoot).to.be.not.null;
			expect(scInclude.shadowRoot.innerHTML.trim()).to.be
				.sameHTMLString(REFERENCE_COMPOSITION);
		});
		describe('after composition property is replaced with the new composition that also contains `content` tags and `::content`', function () {
			beforeEach(function (done) {
				scInclude.composition = document.importNode(document.querySelector('#composition').content, true);
				setTimeout(done, 500);
			});
			it('should replace them with applicable content', function () {
				expect(scInclude.shadowRoot).to.be.not.null;
				expect(scInclude.shadowRoot.innerHTML.trim()).to.be
					.sameHTMLString(REFERENCE_COMPOSITION);
			});
		});

	});
	</script>

</body>

</html>
