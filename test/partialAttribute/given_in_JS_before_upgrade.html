<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

    <script src="../../../webcomponentsjs/webcomponents.js"></script>
    <script src="../../../document-register-element/build/document-register-element.js"></script>
    <script src="../../../web-component-tester/browser.js"></script>
    <script src="../helpers/chainable-methods-for-partial.js"></script>

    <!-- <link rel="import" href="../../starcounter-include.html"> -->
    <script src="../helpers/WCT-Polyfill_bugs_workaround.js"></script>
</head>

<body>

    <test-fixture id="nothing">
        <template>
            <starcounter-include></starcounter-include>
        </template>
    </test-fixture>

    <script>
        var scInclude;
        var model = {
            "Html": "../templateToInclude.html",
            "doesItWork": "works!"
        };
        describe('when `partial` property is set before element upgrade, once definition is imported', function(){
            // we will run it only once as we cannot "undefine"/"unregister" custom element.
            before(function(done){
                scInclude = fixture('nothing');
                scInclude.partial = model;
                // load element definition
                var link = document.createElement('link');
                link.rel = "import";
                link.href = "../../starcounter-include.html";

                link.onload = function definitionInported() {
                    // wait for polyfills
                    setTimeout(done, 100);
                }
                document.head.appendChild(link);

            });
            it('should preserve `.partial` value', function () {
                expect(scInclude.partial).to.equal(model);
            });
            it('should attach `.Html` property as content attribute for `<imported-template>`', function () {
                expect(scInclude.querySelector_template_for_buggy_polyfill().getAttribute("content")).to.equal("../templateToInclude.html");
            });
            it('should attach partial model to `imported-template`', function () {
                expect(JSON.stringify(scInclude.querySelector_template_for_buggy_polyfill().model)).to.equal(JSON.stringify(model));
            });
        });

        function clone (obj) {
            return JSON.parse(JSON.stringify(obj));
        }
    </script>

</body>

</html>
