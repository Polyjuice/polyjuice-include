<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

    <script src="../../../webcomponentsjs/webcomponents.js"></script>
    <script src="../../../web-component-tester/browser.js"></script>

    <link rel="import" href="../../starcounter-include.html">
</head>

<body>

    <test-fixture id="nothing">
        <template>
            <!-- nest to workaround test-fixture bug -->
            <div>
                <starcounter-include></starcounter-include>
            </div>
        </template>
    </test-fixture>

    <script>
        describe('cleanup changes of Layout', function() {
            var instance;
            var model = {
                "Html": "../templateToInclude.html",
                "LauncherLayoutInfo": {
                    "Layout": '{"width":1000,"items":[]}'
                },
                "doesItWork": "works!"
            };

            describe("should remove Layout when", function() {
                beforeEach(function() {
                    instance = fixture('nothing').querySelector('starcounter-include');
                    instance.partial = clone(model);
                });

                it('the `partial` attribute is changed to an empty string', function(done) {
                    expect(instance).to.have.layoutAttached;
                    instance.setAttribute("partial", "");
                    expect(instance).to.have.layoutCleanedUp;
                    done();
                });

                it('when the `partial` property is changed to an empty string', function(done) {
                    expect(instance).to.have.layoutAttached;
                    instance.partial = "";
                    expect(instance).to.have.layoutCleanedUp;
                    done();
                });

                it('when the `partial` property is changed to null', function(done) {
                    expect(instance).to.have.layoutAttached;
                    instance.partial = null;
                    expect(instance).to.have.layoutCleanedUp;
                    done();
                });

                it('when the `partial` property is changed to undefined', function(done) {
                    expect(instance).to.have.layoutAttached;
                    instance.partial = undefined;
                    expect(instance).to.have.layoutCleanedUp;
                    done();
                });

                it('when the `partial` property is changed to empty object', function(done) {
                    expect(instance).to.have.layoutAttached;
                    instance.partial = {};
                    expect(instance).to.have.layoutCleanedUp;
                    done();
                });

                it('when the `partial` property is changed to a partial without Layout', function(done) {
                    expect(instance).to.have.layoutAttached;
                    instance.partial = {
                        "Html": "../templateToInclude.html",
                        "doesItWork": "works!"
                    };
                    expect(instance).to.have.layoutCleanedUp;
                    done();
                });

                it('when the `partial` property is changed to a partial with empty Layout', function(done) {
                    expect(instance).to.have.layoutAttached;
                    instance.partial = {
                        "Html": "../templateToInclude.html",
                        "LauncherLayoutInfo": {
                            "Layout": ""
                        },
                        "doesItWork": "works!"
                    };
                    expect(instance).to.have.layoutCleanedUp;
                    done();
                });
            });

            function clone(obj) {
                return JSON.parse(JSON.stringify(obj));
            }
        });
        chai.Assertion.addProperty('layoutAttached', function () {
          var obj = chai.util.flag(this, 'object');
          new chai.Assertion(obj.grid.setup).to.have.property("width");
          new chai.Assertion(obj.sync.storedValue).to.have.property("width");
        });
        chai.Assertion.addProperty('layoutCleanedUp', function () {
          var obj = chai.util.flag(this, 'object');
          new chai.Assertion(obj.grid).to.respondTo('hasAttribute');
          new chai.Assertion(obj.grid.hasAttribute('setup')).to.be.false;
          new chai.Assertion(obj.sync.storedValue).to.be.null;
        });
    </script>

</body>

</html>
