<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

    <script src="../../../webcomponentsjs/webcomponents.js"></script>
    <script src="../../../web-component-tester/browser.js"></script>

    <link rel="import" href="../../../polymer/polymer.html">
    <!-- Step 1: import the element to test -->
    <link rel="import" href="../../starcounter-include.html">
</head>

<body>
    <test-fixture id="root">
        <template>
            <div>
                <template is="dom-bind">
                    <starcounter-include partial="{{model.Page}}"></starcounter-include>
                </template>
            </div>
        </template>
    </test-fixture>
    <script>
        var model = {
            Html: "../old_templateToInclude.html",
            doesItWork: "worked!"
        };
        var changedModel = {
            Html: "../templateToInclude.html",
            doesItWork: "works!"
        };
        var modelWithEmptyLayout = {
            Html: "../old_templateToInclude.html",
            Layout: "",
            doesItWork: "worked!"
        };
        var changedModelWithEmptyLayout = {
            Html: "../templateToInclude.html",
            Layout: "",
            doesItWork: "works!"
        };

        describe('after changing partial', function() {
            var container, domBind, include;

            describe('without Layout', function() {

                before(function(done) {
                    container = fixture('root');
                    domBind = container.querySelector('template[is=dom-bind]');
                    domBind.model = {
                        Page: model
                    };
                    setTimeout(function() {
                        include = container.querySelector('starcounter-include');
                        done();
                    }, 500);
                });

                it('should forward juicy-style attributes from original partial', function(done) {
                    expectLayoutHintsFromOldPartial();
                    domBind.set('model.Page', changedModel);
                    setTimeout(function() {
                        expectLayoutHintsFromNewPartial();
                        done();
                    }, 500);
                });
            });



            describe('with empty Layout', function() {

                before(function(done) {
                    container = fixture('root');
                    domBind = container.querySelector('template[is=dom-bind]');
                    domBind.model = {
                        Page: modelWithEmptyLayout
                    };
                    setTimeout(function() {
                        include = container.querySelector('starcounter-include');
                        done();
                    }, 500);
                });

                it('should forward juicy-style attributes from original partial', function(done) {
                    expectLayoutHintsFromOldPartial();
                    domBind.set('model.Page', changedModelWithEmptyLayout);
                    setTimeout(function() {
                        expectLayoutHintsFromNewPartial();
                        done();
                    }, 500);
                });
            });

            function expectLayoutHintsFromOldPartial() {
                expect(include.compositionElement.children[0 + 1].getAttribute('juicy-style')).to.equal("background: red");
                expect(include.compositionElement.children[1 + 1].getAttribute('juicy-style')).to.equal(null);
            }

            function expectLayoutHintsFromNewPartial() {
                expect(include.compositionElement.children[0 + 1].getAttribute('juicy-style')).to.equal(null);
                expect(include.compositionElement.children[1 + 1].getAttribute('juicy-style')).to.equal("background: green");
            }
        });
    </script>

</body>

</html>
